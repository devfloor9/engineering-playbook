---
title: "CoreDNS ëª¨ë‹ˆí„°ë§ê³¼ ì„±ëŠ¥ ìµœì í™” ì™„ë²½ ê°€ì´ë“œ"
sidebar_label: "CoreDNS ëª¨ë‹ˆí„°ë§ & ìµœì í™”"
description: "Amazon EKSì˜ CoreDNS ì„±ëŠ¥ì„ ì²´ê³„ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³  ìµœì í™”í•˜ëŠ” ë°©ë²•. Prometheus ë©”íŠ¸ë¦­, TTL íŠœë‹, ëª¨ë‹ˆí„°ë§ ì•„í‚¤í…ì²˜, ì‹¤ì œ ë¬¸ì œ í•´ê²° ì‚¬ë¡€ í¬í•¨"
tags: [eks, coredns, dns, monitoring, prometheus, performance]
category: "performance-networking"
last_update:
  date: 2025-05-20
  author: devfloor9
sidebar_position: 6
---

# CoreDNS ëª¨ë‹ˆí„°ë§ ë° ìµœì í™” ê°€ì´ë“œ

> ğŸ“… **ì‘ì„±ì¼**: 2025-05-20 | â±ï¸ **ì½ëŠ” ì‹œê°„**: ì•½ 24ë¶„


Amazon EKSì™€ ìµœì‹  Kubernetes í´ëŸ¬ìŠ¤í„°ì—ì„œ **CoreDNS**ëŠ” í´ëŸ¬ìŠ¤í„° ë‚´ ëª¨ë“  ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ì™€ ì™¸ë¶€ ë„ë©”ì¸ ì´ë¦„ í•´ì„ì„ ë‹´ë‹¹í•˜ëŠ” í•µì‹¬ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤. CoreDNSì˜ ì„±ëŠ¥ê³¼ ê°€ìš©ì„±ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‘ë‹µ ì‹œê°„ê³¼ ì•ˆì •ì„±ì— ì§ì ‘ì ì¸ ì˜í–¥ì„ ë¯¸ì¹˜ê¸° ë•Œë¬¸ì—, **íš¨ê³¼ì ì¸ ëª¨ë‹ˆí„°ë§ ë° ìµœì í™” ì•„í‚¤í…ì²˜**ë¥¼ êµ¬ì¶•í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ ì•„í‹°í´ì—ì„œëŠ” **CoreDNS ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë©”íŠ¸ë¦­**, **TTL ì„¤ì • ê°€ì´ë“œ**, **ëª¨ë‹ˆí„°ë§ ì•„í‚¤í…ì²˜ ëª¨ë²” ì‚¬ë¡€**, **AWS ê¶Œì¥ ì‚¬í•­ ë° ì‹¤ë¬´ ì‚¬ë¡€**ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤. ê° ì„¹ì…˜ì—ì„œëŠ” Prometheus ë©”íŠ¸ë¦­, Amazon EKS í™˜ê²½ì—ì„œì˜ ì ìš© ì˜ˆì‹œë¥¼ í™œìš©í•˜ì—¬ CoreDNS ëª¨ë‹ˆí„°ë§ ì „ëµì„ ì•Œì•„ë´…ë‹ˆë‹¤.

## 1. CoreDNS ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§: ì£¼ìš” Prometheus ë©”íŠ¸ë¦­ê³¼ ì˜ë¯¸

CoreDNSëŠ” `metrics` í”ŒëŸ¬ê·¸ì¸ì„ í†µí•´ **Prometheus í˜•ì‹ì˜ ë©”íŠ¸ë¦­**ë¥¼ ì œê³µí•˜ë©°, ê¸°ë³¸ì ìœ¼ë¡œ EKSì—ì„œëŠ” `kube-dns` ì„œë¹„ìŠ¤ì˜ `9153` í¬íŠ¸ë¡œ ë…¸ì¶œë©ë‹ˆë‹¤. í•µì‹¬ ë©”íŠ¸ë¦­ë“¤ì€ **DNS ìš”ì²­ì˜ ì²˜ë¦¬ëŸ‰, ì§€ì—° ì‹œê°„, ì˜¤ë¥˜, ìºì‹± íš¨ìœ¨** ë“±ì„ ë³´ì—¬ì£¼ë©°, ì´ë¥¼ ëª¨ë‹ˆí„°ë§í•¨ìœ¼ë¡œì¨ DNS ì„±ëŠ¥ ë³‘ëª©ì´ë‚˜ ì¥ì•  ì§•í›„ë¥¼ ë¹ ë¥´ê²Œ í¬ì°©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ **í‘œ 1**ì€ CoreDNSì˜ ì£¼ìš” Prometheus ë©”íŠ¸ë¦­ê³¼ ê·¸ ì˜ë¯¸ ë° í™œìš©ë²•ì„ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤.

**í‘œ 1. CoreDNS ì£¼ìš” Prometheus ë©”íŠ¸ë¦­ê³¼ ì˜ë¯¸**

ì´ ì™¸ì—ë„ **ìš”ì²­/ì‘ë‹µ í¬ê¸°**(`coredns_dns_request_size_bytes`, `...response_size_bytes`), **DO ë¹„íŠ¸ ì„¤ì • ì—¬ë¶€**(`coredns_dns_do_requests_total`) ë“±ì˜ ë©”íŠ¸ë¦­ê°€ ì œê³µë˜ë©°, CoreDNSì— ë¡œë“œëœ **í”ŒëŸ¬ê·¸ì¸ë³„ ì¶”ê°€ ë©”íŠ¸ë¦­**ë„ ì¡´ì¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ **Forward í”ŒëŸ¬ê·¸ì¸**ì„ í†µí•œ ì—…ìŠ¤íŠ¸ë¦¼ ì§ˆì˜ ì‹œê°„(`coredns_forward_request_duration_seconds`)ì´ë‚˜ **kubernetes í”ŒëŸ¬ê·¸ì¸**ì˜ API ì—…ë°ì´íŠ¸ ì§€ì—°(`coredns_kubernetes_dns_programming_duration_seconds`) ë“±ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë©”íŠ¸ë¦­ë“¤ì„ ì¢…í•©ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ë©´ CoreDNSì˜ **4ê°€ì§€ ê³¨ë“  ì‹œê·¸ë„**ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### CoreDNS ê³¨ë“œ ì‹œê·¸ë„

1. **íŠ¸ë˜í”½(Throughput)**
2. **ì§€ì—° ì‹œê°„(Latency)**
3. **ì˜¤ë¥˜(Errors)**
4. **ìì› ì‚¬ìš©ëŸ‰(Resource)**

### ì£¼ìš” ë©”íŠ¸ë¦­ ì˜ë¯¸ ë° í™œìš©

ì˜ˆë¥¼ ë“¤ì–´ `coredns_dns_requests_total`ì˜ ì´ˆë‹¹ ì¦ê°€ìœ¨ë¡œ **DNS QPS**ë¥¼ íŒŒì•…í•˜ê³ , ì´ë¥¼ CoreDNS Podë³„ë¡œ ë‚˜ëˆ„ì–´ ë¶€í•˜ê°€ **ê· ë“±**í•œì§€ í™•ì¸í•©ë‹ˆë‹¤. QPSê°€ ì§€ì†ì ìœ¼ë¡œ ì¦ê°€í•˜ë©´ CoreDNS **ìŠ¤ì¼€ì¼ ì•„ì›ƒ**ì´ í•„ìš”í•œì§€ ê²€í† í•©ë‹ˆë‹¤. `coredns_dns_request_duration_seconds`ì˜ 99í¼ì„¼íƒ€ì¼ì´ í‰ì†Œë³´ë‹¤ ë†’ì•„ì§€ë©´, CoreDNSê°€ **ì‘ë‹µ ì§€ì—°**ì„ ê²ªê³  ìˆë‹¤ëŠ” ì˜ë¯¸ì´ë¯€ë¡œ **ì—…ìŠ¤íŠ¸ë¦¼ DNS ì§€ì—°**ì´ë‚˜ CoreDNS **CPU/ë©”ëª¨ë¦¬ í¬í™”** ì—¬ë¶€ë¥¼ ì ê²€í•©ë‹ˆë‹¤. ì´ ë•Œ CoreDNS ìºì‹œ(`coredns_cache_hits_total`) hit ë¹„ìœ¨ì´ ë‚®ë‹¤ë©´, TTLì´ ë„ˆë¬´ ì§§ì•„ ìºì‹œíš¨ê³¼ê°€ ë–¨ì–´ì§€ëŠ”ì§€ í™•ì¸í•˜ê³  ì¡°ì •í•©ë‹ˆë‹¤. `coredns_dns_responses_total`ì—ì„œ `SERVFAIL` ë˜ëŠ” `REFUSED` ë¹„ìœ¨ì´ ì¦ê°€í•˜ë©´ CoreDNS **ì™¸ë¶€ í†µì‹  ë¬¸ì œ**ë‚˜ **ì ‘ê·¼ ê¶Œí•œ ë¬¸ì œ**ê°€ ì—†ëŠ”ì§€ ë¡œê·¸ë¥¼ ì ê²€í•´ì•¼ í•©ë‹ˆë‹¤. í•œí¸ `NXDOMAIN` ì¦ê°€ê°€ íŠ¹ì • ë„ë©”ì¸ì— ëŒ€í•´ ê¸‰ì¦í•œë‹¤ë©´, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì˜ëª»ëœ ë„ë©”ì¸ì„ ì¡°íšŒí•˜ê³  ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í•´ë‹¹ ë¶€ë¶„ì„ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.

ë˜í•œ **ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ë©”íŠ¸ë¦­** (CPU/ë©”ëª¨ë¦¬)ë„ ì¤‘ìš”í•©ë‹ˆë‹¤. CoreDNS Podì˜ CPU/ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì„ ëª¨ë‹ˆí„°ë§í•˜ì—¬, ê° Podê°€ **ë¦¬ì†ŒìŠ¤ í•œê³„ì— ê·¼ì ‘**í•˜ëŠ” ê²½ìš° ì•Œë¦¼ì„ ì„¤ì •í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ EKSì˜ ê¸°ë³¸ CoreDNS **ë©”ëª¨ë¦¬ ìš”ì²­/ì œí•œì€ 70Mi/170Mi**ë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ 150Mië¥¼ ë„˜ì–´ì„œëŠ”ì§€ ì¶”ì í•˜ì—¬ ì„ê³„ì¹˜ ë„ë‹¬ ì‹œ ê²½ë³´ë¥¼ ìš¸ë¦¬ê³  ë©”ëª¨ë¦¬ í•œê³„ë¥¼ ëŠ˜ë¦¬ê±°ë‚˜ Podì„ ì¶”ê°€í•˜ëŠ” ë“±ì˜ ì¡°ì¹˜ë¥¼ ì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. CPUë„ ì œí•œì— ë„ë‹¬í•˜ë©´ kubeletì´ CoreDNS í”„ë¡œì„¸ìŠ¤ë¥¼ **ìŠ¤ë¡œí‹€ë§**í•˜ì—¬ DNS ì§€ì—°ì„ ì´ˆë˜í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, CPU ì‚¬ìš©ë¥ ì´ ì œí•œì¹˜ì— ê·¼ì ‘í•˜ë©´ í™•ì¥ì´ë‚˜ ìì› í• ë‹¹ ì¦ì„¤ì„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.

### ì°¸ê³ í•´ì•¼ í•  ì¶”ê°€ ì‚¬í•­(ENI DNS íŒ¨í‚· ì œí•œ)

:::warning VPC ENI DNS íŒ¨í‚· ì œí•œ
ê° ë…¸ë“œ ENIëŠ” ì´ˆë‹¹ 1024ê°œì˜ DNS íŒ¨í‚·ë§Œ í—ˆìš©í•©ë‹ˆë‹¤. CoreDNSì˜ 1000 ë™ì‹œ ì§ˆì˜ í•œê³„ë¥¼ í’€ì–´ë„, ENI PPS í•œê³„(1024 PPS)ì˜ ì œí•œìœ¼ë¡œ ì¸í•˜ì—¬ ì›í•˜ëŠ” ì„±ëŠ¥ì— ë„ë‹¬í•˜ì§€ ëª»í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
:::

## 2. CoreDNS TTL ì„¤ì • ê°€ì´ë“œ ë° Amazon EKS ì ìš© ì˜ˆì‹œ

**TTL(Time-To-Live)**ì€ DNS ë ˆì½”ë“œì˜ ìœ íš¨ ìºì‹œ ì‹œê°„ì„ ì˜ë¯¸í•˜ë©°, ì ì ˆí•œ TTL ì„¤ì •ì€ **DNS íŠ¸ë˜í”½ ë¶€í•˜**ì™€ **ì •ë³´ ì‹ ì„ ë„** ì‚¬ì´ì˜ ê· í˜•ì„ ì¢Œìš°í•©ë‹ˆë‹¤. CoreDNSì—ì„œëŠ” ë‘ ê°€ì§€ ìˆ˜ì¤€ì—ì„œ TTLì„ ë‹¤ë£¹ë‹ˆë‹¤:

- **ê¶Œí•œ ì˜ì—­ ë ˆì½”ë“œ(SOA, Start of Authority) TTL:** Kubernetes í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ ë„ë©”ì¸(`cluster.local` ë“±)ì— ëŒ€í•œ **kubernetes í”ŒëŸ¬ê·¸ì¸** ì‘ë‹µ TTLë¡œ, ê¸°ë³¸ê°’ì€ **5ì´ˆ**ì…ë‹ˆë‹¤. CoreDNS `Corefile`ì—ì„œ `kubernetes` ì„¹ì…˜ì— `ttl` ì˜µì…˜ì„ ì§€ì •í•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìœ¼ë©°, ìµœì†Œ 0ì´ˆ(ìºì‹± ì•ˆ í•¨)ì—ì„œ ìµœëŒ€ 3600ì´ˆê¹Œì§€ ì„¤ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.
- **ìºì‹œ TTL:** **cache í”ŒëŸ¬ê·¸ì¸**ì—ì„œ ìºì‹œëœ í•­ëª©ì„ ë³´ê´€í•˜ëŠ” ìµœëŒ€ ì‹œê°„ìœ¼ë¡œ, ê¸°ë³¸ê°’ì€ **ìµœëŒ€ 3600ì´ˆ (ì„±ê³µ ì‘ë‹µ)**ì´ë©° CoreDNS ì„¤ì •ì—ì„œ `cache [TTL]` í˜•íƒœë¡œ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì§€ì •ëœ TTLì€ **ìƒí•œì¹˜**ë¡œ ë™ì‘í•˜ë©°, ì‹¤ì œ DNS ë ˆì½”ë“œì˜ TTLì´ ê·¸ë³´ë‹¤ ì§§ìœ¼ë©´ ê·¸ ì§§ì€ ê°’ì— ë”°ë¼ ìºì‹œì—ì„œ ì œê±°ë©ë‹ˆë‹¤. (`cache` í”ŒëŸ¬ê·¸ì¸ì˜ ê¸°ë³¸ ìµœì†Œ TTLì€ 5ì´ˆì´ë©°, `MINTTL`ë¡œ ì¡°ì • ê°€ëŠ¥).

### Amazon EKS ê¸°ë³¸ CoreDNS ì„¤ì •

EKSì— ë°°í¬ë˜ëŠ” ê¸°ë³¸ CoreDNS Corefileì„ ì‚´í´ë³´ë©´, `kubernetes` í”ŒëŸ¬ê·¸ì¸ì— ë³„ë„ì˜ TTLì´ ì§€ì •ë˜ì§€ ì•Šì•„ **ê¸°ë³¸ 5ì´ˆ**ê°€ ì‚¬ìš©ë˜ê³  ìˆê³ , ëŒ€ì‹  `cache 30` ì„¤ì •ì„ í†µí•´ **ëª¨ë“  DNS ì‘ë‹µì„ ìµœëŒ€ 30ì´ˆê¹Œì§€ ìºì‹œ**í•˜ë„ë¡ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì¦‰ **ë‚´ë¶€ ì„œë¹„ìŠ¤ ë ˆì½”ë“œ**ì˜ TTLì€ ì‘ë‹µ íŒ¨í‚·ìƒ 5ì´ˆì´ì§€ë§Œ, CoreDNS ìì²´ëŠ” cache í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ ìµœëŒ€ 30ì´ˆê°„ ì‘ë‹µì„ ìºì‹±í•˜ì—¬ ë™ì¼í•œ ì§ˆì˜ì— ëŒ€í•´ ë¹ˆë²ˆíˆ Kubernetes APIë¥¼ ì¡°íšŒí•˜ì§€ ì•Šë„ë¡ ìµœì í™”í•©ë‹ˆë‹¤. ë˜í•œ ì™¸ë¶€ ë„ë©”ì¸ ì¡°íšŒ ì‹œì—ë„ ìµœëŒ€ 30ì´ˆê°„ ê²°ê³¼ë¥¼ ìºì‹±í•˜ì—¬, ì˜ˆë¥¼ ë“¤ì–´ TTLì´ ë§¤ìš° í° ì™¸ë¶€ ë ˆì½”ë“œë¼ë„ 30ì´ˆ ì´í›„ì—ëŠ” ê°±ì‹ í•˜ë„ë¡ í•¨ìœ¼ë¡œì¨ **ì§€ë‚˜ì¹˜ê²Œ ì˜¤ë˜ëœ DNS ì •ë³´**ë¥¼ ë“¤ê³  ìˆì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.

### TTL ì„¤ì • ê°€ì´ë“œ

ì¼ë°˜ì ìœ¼ë¡œ **ì§§ì€ TTL(ì˜ˆ: 5ì´ˆ ì´í•˜)**ì€ DNS ë ˆì½”ë“œ ë³€ê²½ì‚¬í•­(ì˜ˆ: ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ IPë‚˜ Pod IP ë³€í™”)ì´ ì‹ ì†íˆ ë°˜ì˜ë˜ëŠ” ì¥ì ì´ ìˆìœ¼ë‚˜, í´ë¼ì´ì–¸íŠ¸ë‚˜ DNS ìºì‹œì— ì˜í•œ **ë°˜ë³µ ì¡°íšŒê°€ ë§ì•„** CoreDNS ë¶€í•˜ê°€ ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°˜ëŒ€ë¡œ **ê¸´ TTL(ì˜ˆ: ìˆ˜ë¶„ ì´ìƒ)**ì€ DNS ì§ˆì˜ ë¹ˆë„ë¥¼ ì¤„ì—¬ ì„±ëŠ¥ì„ ë†’ì´ì§€ë§Œ, ë³€ê²½ ì‚¬í•­ ì „íŒŒê°€ ì§€ì—°ë˜ì–´ **êµ¬í˜• ì •ë³´**ë¡œ ì¸í•œ ì¼ì‹œì  ì—°ê²° ì‹¤íŒ¨ ê°€ëŠ¥ì„±ì´ ì»¤ì§‘ë‹ˆë‹¤. **ê¶Œì¥ë˜ëŠ” ì ‘ê·¼ë²•**ì€ í´ëŸ¬ìŠ¤í„° í¬ê¸°ì™€ ì›Œí¬ë¡œë“œ íŒ¨í„´ì— ë”°ë¼ TTLì„ **ì ë‹¹íˆ (ìˆ˜ì‹­ ì´ˆ ë‹¨ìœ„)** ëŠ˜ë ¤ **ìºì‹œ ì ì¤‘ë¥ ì„ ë†’ì´ë©´ì„œ** ì‹¬ê°í•œ ì •ë³´ ì§€ì—°ì€ í”¼í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë§ì€ Kubernetes í™˜ê²½ì—ì„œ **TTL 30ì´ˆ** ì „í›„ê°€ í•˜ë‚˜ì˜ ê¸°ì¤€ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ CoreDNS Kubernetes í”ŒëŸ¬ê·¸ì¸ì˜ TTLì„ 30ì´ˆë¡œ ëŠ˜ë¦¬ë©´, ì„œë¹„ìŠ¤/ì—”ë“œí¬ì¸íŠ¸ ë³€ê²½ì´ ë°œìƒí•´ë„ ìµœëŒ€ 30ì´ˆ ë‚´ì—ëŠ” DNSê°€ ê°±ì‹ ë˜ë©°, ê·¸ ì‚¬ì´ DNS ì§ˆì˜ ë¶€í•˜ëŠ” í¬ê²Œ ê°ì†Œí•©ë‹ˆë‹¤. Amazon EKSë„ ê¸°ë³¸ ìºì‹œ TTLì„ 30ì´ˆë¡œ ë‘ ìœ¼ë¡œì¨ ì´ëŸ¬í•œ ê· í˜•ì„ ì·¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.

### Amazon EKS ì ìš© ì˜ˆì‹œ

EKSì—ì„œ TTLì„ ì¡°ì •í•˜ë ¤ë©´ **CoreDNS ConfigMap**ì„ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë‚´ë¶€ ë„ë©”ì¸ ìºì‹œ ì‹œê°„ì„ ëŠ˜ë¦¬ê³ ì í•œë‹¤ë©´, Corefileì˜ `kubernetes cluster.local ...` ë¸”ë¡ì— `ttl 30`ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ **í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ DNS ì‘ë‹µì˜ TTL í•„ë“œ**ê°€ 30ì´ˆë¡œ ì¦ê°€í•˜ì—¬, í´ë¼ì´ì–¸íŠ¸ ì¸¡(ì˜ˆ: NodeLocal DNSCacheë‚˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ëŸ°íƒ€ì„)ì´ ì´ë¥¼ ì°¸ê³ í•´ ìºì‹±í•  ê²½ìš° 30ì´ˆê°„ ì¬ì¡°íšŒí•˜ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤. ë‹¤ë§Œ Kubernetes í™˜ê²½ì—ì„œëŠ” ì¼ë°˜ì ì¸ ë¦¬ëˆ…ìŠ¤ glibc resolverê°€ ìì²´ ìºì‹œë¥¼ í•˜ì§€ ì•Šê³  ë§¤ë²ˆ CoreDNSì— ì¡°íšŒí•˜ê¸° ë•Œë¬¸ì—, **NodeLocal DNSCache**ì™€ ê°™ì€ ë³´ì¡° ìºì‹œê°€ ì—†ìœ¼ë©´ TTLì„ ëŠ˜ë ¤ë„ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì´ì ì€ ì œí•œì ì…ë‹ˆë‹¤. ì£¼ë¡œ CoreDNS ìì²´ì˜ ë¶€í•˜ ê²½ê°ì„ ìœ„í•˜ì—¬ TTLì„ ì¡°ì •í•˜ê²Œ ë©ë‹ˆë‹¤.

:::warning Aurora DNS ë¡œë“œë°¸ëŸ°ì‹± ì´ìŠˆ
**AWS Aurora**ì™€ ê°™ì´ **DNS ë¡œë“œë°¸ëŸ°ì‹±ì„ ìœ„í•´ ë§¤ìš° ë‚®ì€ TTL(1ì´ˆ)**ì„ ì‚¬ìš©í•˜ëŠ” ì„œë¹„ìŠ¤ê°€ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° CoreDNSê°€ ê¸°ë³¸ ìµœì†Œ TTL 5ì´ˆë¡œ ì¸í•´ ì›ë˜ 1ì´ˆ TTLì„ 5ì´ˆë¡œ **ê³¼ë„ ìºì‹±**í•˜ì—¬ Aurora ë¦¬ë” ì—”ë“œí¬ì¸íŠ¸ íŠ¸ë˜í”½ ë¶„ì‚°ì´ ì™œê³¡ë˜ëŠ” ë¬¸ì œê°€ ë³´ê³ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ìƒí™©ì—ì„œëŠ” **íŠ¹ì • ë„ë©”ì¸ì— í•œí•´ TTLì„ ë‚®ì¶”ëŠ” ì„¤ì •**ì„ ë„ì…í•´ì•¼ í•©ë‹ˆë‹¤.
:::

ì‹¤ì œ ì‚¬ë¡€ì—ì„œëŠ” NodeLocal DNSCache CoreDNS ì„¤ì •ì— `amazonaws.com` ì˜ì—­ì— ëŒ€í•´ `cache 1` ë° `success/denial 1` TTL ì„¸ë¶€ ì„¤ì •ì„ ì ìš©í•¨ìœ¼ë¡œì¨, Aurora ì—”ë“œí¬ì¸íŠ¸ì˜ ì›ë˜ TTL 1ì´ˆë¥¼ ì¤€ìˆ˜í•˜ë„ë¡ êµ¬ì„±í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ **ì™¸ë¶€ ì„œë¹„ìŠ¤ì˜ TTL ì •ì±…**ë„ ê³ ë ¤í•˜ì—¬ CoreDNSì˜ TTLê³¼ ìºì‹œ ì „ëµì„ íŠœë‹í•´ì•¼ í•©ë‹ˆë‹¤.

## 3. CoreDNS ëª¨ë‹ˆí„°ë§ ì•„í‚¤í…ì²˜ ëª¨ë²” ì‚¬ë¡€

CoreDNS ëª¨ë‹ˆí„°ë§ ì•„í‚¤í…ì²˜ëŠ” **ë©”íŠ¸ë¦­ ìˆ˜ì§‘(Prometheus ë“±)**ê³¼ **ë¡œê·¸ ìˆ˜ì§‘(ì˜ˆ: Fluent Bit ë“±)**, ê·¸ë¦¬ê³  ì‹œê°í™” ë° ì•Œë¦¼ ì²´ê³„ë¥¼ ëª¨ë‘ í¬í•¨í•˜ëŠ” **í†µí•©ì ì¸ ê´€ì°°ì„± íŒŒì´í”„ë¼ì¸**ìœ¼ë¡œ êµ¬ì¶•í•˜ëŠ” ê²ƒì´ ì´ìƒì ì…ë‹ˆë‹¤. Amazon EKS í™˜ê²½ì—ì„œëŠ” **Managed ì„œë¹„ìŠ¤**ì™€ **ì˜¤í”ˆì†ŒìŠ¤ ë„êµ¬**ë¥¼ ì¡°í•©í•˜ì—¬ ì•ˆì •ì ì´ê³  í™•ì¥ ê°€ëŠ¥í•œ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ì €ì¥

Amazon EKSì—ì„œëŠ” CoreDNSì˜ Prometheus ë©”íŠ¸ë¦­ë¥¼ ìˆ˜ì§‘í•˜ê¸° ìœ„í•´ **ë‘ ê°€ì§€ ì ‘ê·¼**ì´ ì¼ë°˜ì ì…ë‹ˆë‹¤:

1. **Amazon Managed Service for Prometheus (AMP)**: AWSì—ì„œ ì œê³µí•˜ëŠ” **ì™„ì „ ê´€ë¦¬í˜• Prometheus í˜¸í™˜** ì„œë¹„ìŠ¤ë¡œ, í´ëŸ¬ìŠ¤í„° ë‚´ ë©”íŠ¸ë¦­ë¥¼ ì›ê²© ìˆ˜ì§‘(remote write)í•˜ì—¬ **í™•ì¥ì„± ë†’ì€ ì‹œê³„ì—´ DB**ì— ë³´ê´€í•©ë‹ˆë‹¤. EKS í´ëŸ¬ìŠ¤í„°ì—ëŠ” **ADOT(AWS Distro for OpenTelemetry) Collector** ë˜ëŠ” **Prometheus ì„œë²„**ë¥¼ ì„¤ì¹˜í•˜ì—¬ CoreDNS ë©”íŠ¸ë¦­ë¥¼ ìŠ¤í¬ë©í•œ í›„ AMPë¡œ ì „ì†¡í•©ë‹ˆë‹¤. AWS Observability ê°€ì´ë“œì—ì„œëŠ” Terraform ê¸°ë°˜ìœ¼ë¡œ ADOT Collector ë° AMP ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¥¼ ìƒì„±/êµ¬ì„±í•˜ì—¬ EKS ëª¨ë‹ˆí„°ë§ì„ ìë™í™”í•  ìˆ˜ ìˆëŠ” **ê°€ì†ê¸°(Accelerator)**ë„ ì œê³µí•©ë‹ˆë‹¤. AMPì— ì €ì¥ëœ ë©”íŠ¸ë¦­ì€ **PromQL**ë¡œ ì¿¼ë¦¬ ê°€ëŠ¥í•˜ë©°, ì¥ê¸° ë³´ê´€ ë° ëŒ€ê·œëª¨ í´ëŸ¬ìŠ¤í„° ì§€ì›ì— ì í•©í•©ë‹ˆë‹¤.

2. **CloudWatch Container Insights (ë° CloudWatch ì—ì´ì „íŠ¸):** AWSì˜ CloudWatchë¥¼ í™œìš©í•˜ì—¬ **Prometheus ë©”íŠ¸ë¦­ì„ CloudWatchë¡œ ìˆ˜ì§‘**í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. CloudWatch ì—ì´ì „íŠ¸ë¥¼ DaemonSetìœ¼ë¡œ ë°°í¬í•˜ê³ , `kube-system/kube-dns` ì„œë¹„ìŠ¤ì˜ 9153 í¬íŠ¸ë¡œë¶€í„° CoreDNS ë©”íŠ¸ë¦­ë¥¼ ìŠ¤í¬ë©í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. AWS ê³µì‹ ë¬¸ì„œì—ì„œëŠ” Prometheus í˜¸í™˜ ë©”íŠ¸ë¦­ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ CloudWatch Agent ì„¤ì • ì˜ˆì œë¥¼ ì œê³µí•˜ë©°, ì´ë ‡ê²Œ ìˆ˜ì§‘ëœ ë©”íŠ¸ë¦­ì€ CloudWatch ì½˜ì†”ì´ë‚˜ CloudWatch Metricsë¡œ ë³´ê´€ë©ë‹ˆë‹¤. CloudWatchëŠ” ë©”íŠ¸ë¦­ì— ëŒ€í•œ **ê²½ë³´(Alarm)** ì—°ê³„ê°€ ìš©ì´í•˜ê³ , AWS ê´€ë¦¬í˜• Grafanaë¥¼ í†µí•´ ì‹œê°í™”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ **CloudWatch ìš”ê¸ˆ** (ë©”íŠ¸ë¦­ ìˆ˜ì§‘/ì €ì¥)ì´ ë°œìƒí•˜ê³ , PromQLì„ ì§ì ‘ ì‚¬ìš©í•˜ê¸°ë³´ë‹¤ëŠ” ì •í•´ì§„ ë©”íŠ¸ë¦­ë¡œ CloudWatch ëŒ€ì‹œë³´ë“œë¥¼ êµ¬ì„±í•˜ëŠ” í˜•íƒœê°€ ë©ë‹ˆë‹¤.

:::tip ServiceMonitor ì„¤ì •
Amazon EKSì˜ kube-dns ì„œë¹„ìŠ¤ëŠ” metrics í¬íŠ¸ë¥¼ ì œê³µí•˜ë¯€ë¡œ, Prometheus Operatorë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ServiceMonitorë¥¼ ìƒì„±í•˜ì—¬ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ k8s-app=kube-dns ë ˆì´ë¸”ì„ ê°€ì§„ ì„œë¹„ìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ 9153í¬íŠ¸ë¥¼ ìŠ¤í¬ë©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
:::

### ë¡œê·¸ ìˆ˜ì§‘

CoreDNSì˜ **ì¿¼ë¦¬ ë¡œê·¸ì™€ ì—ëŸ¬ ë¡œê·¸**ëŠ” ì„±ëŠ¥ ë¬¸ì œë¥¼ ì§„ë‹¨í•˜ê±°ë‚˜ ë³´ì•ˆ ëª¨ë‹ˆí„°ë§(ì˜ˆ: íŠ¹ì • ë„ë©”ì¸ì— ëŒ€í•œ í­ì£¼ ì¡°íšŒ) ì¸¡ë©´ì—ì„œ ìœ ìš©í•œ ì •ë³´æºì…ë‹ˆë‹¤. CoreDNSì˜ ê¸°ë³¸ Corefileì—ëŠ” `log` í”ŒëŸ¬ê·¸ì¸ì´ ì—†ì§€ë§Œ, í•„ìš”ì— ë”°ë¼ `log` ë˜ëŠ” `errors` í”ŒëŸ¬ê·¸ì¸ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ì‹¤ë¬´ì—ì„œëŠ”** CoreDNS Podì˜ í‘œì¤€ ì¶œë ¥(stdout/stderr)ì— ê¸°ë¡ë˜ëŠ” ë¡œê·¸ë¥¼ ìˆ˜ì§‘í•˜ê¸° ìœ„í•´ **Fluent Bit**ì´ë‚˜ **Fluentd**ë¥¼ DaemonSetìœ¼ë¡œ ìš´ìš©í•˜ì—¬ CloudWatch Logsë¡œ ë‚´ë³´ë‚´ëŠ” íŒ¨í„´ì´ í”í•©ë‹ˆë‹¤.

:::warning ë¡œê·¸ ìˆ˜ì§‘ ì£¼ì˜ì‚¬í•­
ê³¼ë„í•œ ë¡œê·¸ ìˆ˜ì§‘ìœ¼ë¡œ ì¸í•œ ë¶€í•˜ë¥¼ í”¼í•˜ê¸° ìœ„í•´ í•„ìš” ìˆ˜ì¤€ìœ¼ë¡œë§Œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. EKS ëª¨ë²” ì‚¬ë¡€ì—ì„œëŠ” Fluent Bit ë“± ì—ì´ì „íŠ¸ê°€ Kubernetes APIë¥¼ ë°˜ë³µ ì¡°íšŒí•˜ì§€ ì•Šë„ë¡ **ë©”íƒ€ë°ì´í„° ìºì‹±**ì„ ì„¤ì •í•˜ê³  (`Kube_Meta_Cache_TTL=60` ë“±) ë¶ˆí•„ìš”í•œ í•„ë“œ ìˆ˜ì§‘ì„ ì¤„ì´ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
:::

### ì‹œê°í™” ë° ëŒ€ì‹œë³´ë“œ

ìˆ˜ì§‘ëœ CoreDNS ë©”íŠ¸ë¦­ì€ **Grafana**ë¥¼ í†µí•´ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œë¡œ ì‹œê°í™”í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤. Amazon Managed Grafana(AMG)ëŠ” AMPë‚˜ CloudWatchì™€ ë„¤ì´í‹°ë¸Œ í†µí•©ë˜ì–´ ë°ì´í„° ì†ŒìŠ¤ë¡œ í™œìš©í•  ìˆ˜ ìˆê³ , **IAM ì—°ë™ SSO**ë¡œ ì ‘ê·¼ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Grafanaì—ì„œ CoreDNS ëŒ€ì‹œë³´ë“œë¥¼ êµ¬ì¶•í•  ë•Œ, **ìš”ì²­ë¥ (QPS), ì‘ë‹µ ì§€ì—°(histogram), ì˜¤ë¥˜ìœ¨(rcode ë¶„í¬), ìºì‹œ íˆíŠ¸ìœ¨** ë“±ì˜ íŒ¨ë„ì„ êµ¬ì„±í•©ë‹ˆë‹¤.

### ì•ŒëŒ/Alerting

**Prometheus Alertmanager** ë˜ëŠ” CloudWatch Alarmsë¥¼ í™œìš©í•˜ì—¬ **DNS ì´ìƒ ì§•í›„ì— ëŒ€í•œ ê²½ë³´**ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. ëŒ€í‘œì ì¸ CoreDNS ê´€ë ¨ Alertmanager **ê·œì¹™ ì˜ˆì‹œ**ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **CoreDNSDown**: ì¼ì • ì‹œê°„ ë™ì•ˆ (`for: 15m` ë“±) CoreDNS ë©”íŠ¸ë¦­(`up{job="kube-dns"}` ë“±)ê°€ ë³´ê³ ë˜ì§€ ì•Šì„ ë•Œ ê²½ë³´.
- **HighDNSLatency**: `coredns_dns_request_duration_seconds`ì˜ **p99 ì§€ì—° ì‹œê°„**ì´ ì˜ˆë¥¼ ë“¤ì–´ **500ms**ë¥¼ ì´ˆê³¼í•˜ê³  í‰ì†Œë³´ë‹¤ ë†’ì„ ë•Œ ê²½ë³´.
- **DNSErrorsSpike**: `coredns_dns_responses_total`ì—ì„œ `rcode` ë¼ë²¨ì´ `SERVFAIL` ë˜ëŠ” `NXDOMAIN`ì¸ ê°’ì˜ ë¹„ìœ¨ì´ ì¼ì • ì„ê³„ì¹˜ ì´ìƒì¼ ë•Œ ê²½ë³´.
- **ENIThrottling**: AWS í™˜ê²½ íŠ¹í™” ë©”íŠ¸ë¦­ë¡œ, **EC2 ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤(ENI)ì˜ DNS íŒ¨í‚· ì œí•œ ì´ˆê³¼**ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ëŠ” ê²½ë³´ì…ë‹ˆë‹¤.
- **HighCoreDNSCPU/Memory**: CoreDNS Podì˜ CPU/ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ëª¨ë‹ˆí„°ë§ ê²½ë³´.

## 4. Amazon EKS ëª¨ë²” ì‚¬ë¡€ ë° ê³ ê° ì‚¬ë¡€ (DNS ë³‘ëª© ëŒ€ì‘ ë“±)

AWS í´ë¼ìš°ë“œ í™˜ê²½ì— íŠ¹í™”ëœ **EKS DNS ìš´ìš© ëª¨ë²”ì‚¬ë¡€**ë¥¼ ë¬¸ì„œì™€ ë¸”ë¡œê·¸ë¥¼ í†µí•´ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì£¼ìš” ê¶Œì¥ì‚¬í•­ê³¼ ê³ ê° ì‚¬ë¡€ì—ì„œ ìì£¼ ë“±ì¥í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

### CoreDNS Horizontal Scaling (ë³µì œìˆ˜ ì¡°ì •)

EKS í´ëŸ¬ìŠ¤í„° ìƒì„± ì‹œ ê¸°ë³¸ CoreDNS Deployment ë³µì œìˆ˜ëŠ” 2ê°œë¡œ ê³ ì •ë˜ì§€ë§Œ, ë…¸ë“œ ìˆ˜ì™€ ì›Œí¬ë¡œë“œ ì¦ê°€ì— ë”°ë¼ **ìˆ˜í‰ í™•ì¥**ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. AWS ëª¨ë²” ì‚¬ë¡€ëŠ” **Cluster Proportional Autoscaler**ë¥¼ ì‚¬ìš©í•´ CoreDNS ë³µì œìˆ˜ë¥¼ **ë…¸ë“œ ìˆ˜ ë˜ëŠ” CPU ì½”ì–´ ìˆ˜ì— ë¹„ë¡€í•˜ì—¬ ìë™ ì¦ê°€**ì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

### NodeLocal DNSCache ë„ì…

**ëŒ€ê·œëª¨ í´ëŸ¬ìŠ¤í„°**ë‚˜ **DNS íŠ¸ë˜í”½ì´ ë§¤ìš° ë¹ˆë²ˆí•œ ì›Œí¬ë¡œë“œ**ì—ì„œëŠ”, CoreDNSë¥¼ ì¤‘ì•™ì—ì„œ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì´ **ë„¤íŠ¸ì›Œí¬ ì§€ì—° ë° ENI í•œê³„**ë¡œ ë³‘ëª©ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Kubernetesì˜ ê³µì‹ ì• ë“œì˜¨ì¸ *NodeLocal DNSCache*ëŠ” **ëª¨ë“  ë…¸ë“œì—ì„œ DNS ìºì‹œ ì—ì´ì „íŠ¸(CoreDNS ê¸°ë°˜)ë¥¼ ë°ëª¬ì…‹ìœ¼ë¡œ ì‹¤í–‰**í•˜ì—¬, ê° Nodeì—ì„œ **ë¡œì»¬ DNS**ë¥¼ ì œê³µí•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

### DNS íŒ¨í‚· í•œê³„ ë° íŠ¸ë˜í”½ ë¶„ì‚°

AWS í™˜ê²½ì˜ í”í•œ ë³‘ëª©ìœ¼ë¡œ **VPC DNS íŒ¨í‚· í•œë„(1024 PPS/ENI)**ê°€ ìˆìŠµë‹ˆë‹¤. ì‹¤ë¬´ ì‚¬ë¡€ë¡œ, ëŒ€ëŸ‰ì˜ ì™¸ë¶€ DNS ì¡°íšŒë¥¼ í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ìˆì„ ê²½ìš° CoreDNS Pod 2ê°œê°€ **ëª¨ë‘ ë™ì¼í•œ ë…¸ë“œ**ì— ë–  ìˆë‹¤ë©´, ê·¸ ë…¸ë“œì˜ ENI í•˜ë‚˜ë¡œ ëª¨ë“  ì™¸ë¶€ DNS ì§ˆì˜ê°€ ë‚˜ê°€ í•œë„ë¥¼ ë„˜ì„ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.

### Graceful Termination ì„¤ì • (Lameduck & Ready í”ŒëŸ¬ê·¸ì¸)

CoreDNS Podë¥¼ ì¬ì‹œì‘í•˜ê±°ë‚˜ ì¶•ì†Œí•  ë•Œ ë°œìƒí•˜ëŠ” **ì¼ì‹œì ì¸ DNS ì‹¤íŒ¨**ë¥¼ ë§‰ê¸° ìœ„í•œ ì„¤ì •ì…ë‹ˆë‹¤. AWS ëª¨ë²” ì‚¬ë¡€ëŠ” CoreDNSì— **lameduck 30s** ì„¤ì •ì„ ì ìš©í•˜ê³ , **Readiness Probe**ë¥¼ `/ready` ì—”ë“œí¬ì¸íŠ¸ë¡œ êµ¬ì„±í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

### ì‹¤ë¬´ ì‚¬ë¡€: DNS ì„±ëŠ¥ ë³‘ëª© í•´ê²°

*ì‚¬ë¡€ 1*: í•œ ê¸°ì—…ì—ì„œ EKS ê¸°ë°˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ ìš´ì˜ ì¤‘, íŠ¹ì • ì„œë¹„ìŠ¤ì˜ DNS ì‘ë‹µì´ ì§€ì—°ë˜ë©° **ì „ì²´ ì‘ë‹µì‹œê°„ì´ 1ì´ˆ ì´ìƒ ì¶”ê°€ë˜ëŠ”** ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¡°ì‚¬ ê²°ê³¼, CoreDNS ìì²´ì—ëŠ” ë¬¸ì œê°€ ì—†ì—ˆì§€ë§Œ CoreDNSê°€ ì§ˆì˜í•˜ëŠ” **VPC DNS Resolverê°€ ENI PPS í•œë„ì— ê±¸ë ¤ íŒ¨í‚·ì„ ë“œë¡­**í•˜ê³  ìˆì–´ ê°„í—ì ìœ¼ë¡œ ì‘ë‹µ ì§€ì—°ì´ ìƒê¸´ ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.

*ì‚¬ë¡€ 2*: ë‹¤ë¥¸ ì‚¬ë¡€ë¡œ, EKSì—ì„œ **Aurora DB í´ëŸ¬ìŠ¤í„°**ë¥¼ ì‚¬ìš©í•˜ë˜ ì¤‘ ì½ê¸° ë¶€í•˜ ë¶„ì‚°ì´ ê³ ë¥´ì§€ ì•Šì•„ ì¼ë¶€ ë¦¬ë” ë…¸ë“œì— ì„¸ì…˜ì´ ëª°ë¦¬ëŠ” í˜„ìƒì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ë¶„ì„ ê²°ê³¼, **Aurora Reader ì—”ë“œí¬ì¸íŠ¸ DNS**ê°€ ì—¬ëŸ¬ DB ë¦¬ë” ë…¸ë“œ IPë¥¼ 1ì´ˆ TTLë¡œ ë¼ìš´ë“œë¡œë¹ˆ ì œê³µí•˜ëŠ”ë°, CoreDNSì™€ NodeLocal DNSCacheê°€ ì´ë¥¼ 5ì´ˆê°„ ìºì‹œí•˜ì—¬ **5ì´ˆ ë™ì•ˆ ë™ì¼í•œ ë¦¬ë” IPë§Œ ì‚¬ìš©**í•˜ê²Œ ëœ ê²ƒì´ ì›ì¸ì´ì—ˆìŠµë‹ˆë‹¤.

### ë” ë†’ì€ QPSê°€ í•„ìš”í•  ë•Œ

1. **`max_concurrent` ìƒí–¥**: `2000` ì´ìƒìœ¼ë¡œ ì¡°ì •í•  ìˆ˜ ìˆì§€ë§Œ, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰(2 KB Ã— ë™ì‹œ ì§ˆì˜ ìˆ˜)ê³¼ upstream DNS ì§€ì—° ì‹œê°„ì„ í•¨ê»˜ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.

2. **CoreDNS ìˆ˜í‰ í™•ì¥**: Replica ìˆ˜ë¥¼ ëŠ˜ë¦¬ê±°ë‚˜ Cluster Proportional Autoscaler, HPA, í˜¹ì€ **NodeLocal DNSCache**ë¡œ ì§ˆì˜ë¥¼ ë…¸ë“œ ë‹¨ìœ¼ë¡œ ë¶„ì‚°í•©ë‹ˆë‹¤.

3. **ENI í•œê³„ ëª¨ë‹ˆí„°ë§**: `aws_ec2_eni_allowance_exceeded` (CloudWatch) ë˜ëŠ” `linklocal_allowance_exceeded` ì§€í‘œì— ì•ŒëŒì„ ê±¸ì–´ ENI PPS ì´ˆê³¼ë¥¼ ì¡°ê¸°ì— íƒì§€í•©ë‹ˆë‹¤.

## í•µì‹¬ ìš”ì•½

- **ë³´ê°•í•  ë©”íŠ¸ë¦­**: request_count_total, request_duration_seconds, cache_hits/misses, response_code_count_total, CPU/ë©”ëª¨ë¦¬.
- **TTL ê¶Œì¥ì¹˜**: ì„œë¹„ìŠ¤ ë ˆì½”ë“œ 30s, cache (success 30, denial 5-10).
- **ëª¨ë‹ˆí„°ë§**: kube-prometheus-stack ê¸°ë³¸ ëŒ€ì‹œë³´ë“œ + Alertmanager ë£°, í•„ìš” ì‹œ NodeLocal DNSCacheë¡œ ìŠ¤ì¼€ì¼-ì•„ì›ƒ.

## 1. CoreDNS ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì—ì„œ ê¼­ ë´ì•¼ í•  ë©”íŠ¸ë¦­

## 2. TTL ì„¤ì • ê°€ì´ë“œ

êµ¬ì„± ì˜ˆì‹œ (Corefile):

```text
.:53 {
  kubernetes cluster.local in-addr.arpa ip6.arpa {
    pods insecure
    fallthrough in-addr.arpa ip6.arpa
    ttl 30           # Service/POD ë ˆì½”ë“œ TTL
  }

  cache 30 {         # ìµœëŒ€ 30ì´ˆ ë³´ì¡´
    success 10000 30 # capacity 10k, maxTTL 30s
    denial 2000 10   # negative cache 2k, maxTTL 10s
    prefetch 5 60s   # ë™ì¼ ì§ˆì˜ 5íšŒâ†‘ë©´ 60s ì „ì— ê°±ì‹ 
  }

  prometheus :9153
  health
  reload
  log
}
```

:::warning TTLì„ ì§§ê²Œ (10ì´ˆ ë¯¸ë§Œ) í•˜ë©´
stale IP ë°œìƒ ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§‘ë‹ˆë‹¤.
:::

## 3. CoreDNS ëª¨ë‹ˆí„°ë§ ì•„í‚¤í…ì²˜ ì œì•ˆ

1. **Prometheus Operator (kube-prometheus-stack)**
   - ServiceMonitor ê°€ kube-system/coredns ë¥¼ **:9153/metrics** ë¡œ ìŠ¤í¬ë ˆì´í”„
   - release=kps ì— í¬í•¨ëœ Grafana k8s-coredns.json ëŒ€ì‹œë³´ë“œ í™œìš©.

2. **Alertmanager ë£° ì˜ˆì‹œ**

```text
- alert: CoreDNSHighErrorRate
  expr: (sum(rate(coredns_dns_response_code_count_total{rcode!~"NOERROR"}[5m])) /
         sum(rate(coredns_dns_request_count_total[5m]))) > 0.01
  for: 10m
  labels:
    severity: critical
  annotations:
    description: "CoreDNS error rate > 1% for 10 min"

- alert: CoreDNSP99Latency
  expr: histogram_quantile(0.99,
          sum(rate(coredns_dns_request_duration_seconds_bucket[5m])) by (le)) > 0.05
  for: 5m
  labels:
    severity: warning
```

3. **ëŒ€ê·œëª¨(>100 ë…¸ë“œ) ë˜ëŠ” QPS > 5k í´ëŸ¬ìŠ¤í„°**
   - **NodeLocal DNSCache** (kube-proxy DaemonSet í˜•íƒœ)ë¡œ ë…¸ë“œ ë¡œì»¬ì—ì„œ ìºì‹œÂ·ë‹¨ì¶• RTT.
   - nodelocaldns ë©”íŠ¸ë¦­ë„ Prometheusì— ìˆ˜ì§‘í•´ CoreDNS â†” NodeLocal ë¹„êµ.

4. **CloudWatch Container Insights**(EKS ì „ìš©)
   Prometheus ìˆ˜ì§‘ì´ ì–´ë ¤ìš´ í™˜ê²½ì´ë¼ë©´ **cwagent + adot-internal-metrics** ì˜µì…˜ìœ¼ë¡œ CoreDNS ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ì„ CloudWatchë¡œ ë³´ë‚¼ ìˆ˜ ìˆìŒ. (ë³„ë„ ìš”ê¸ˆ ë°œìƒ)
